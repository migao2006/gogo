<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æ•´äººå½ˆçª—ç¤ºç¯„ï¼ˆè«‹åœ¨åŒæ„æƒ…å¢ƒä¸‹ä½¿ç”¨ï¼‰</title>
  <style>
    :root{
      --bg:#f7f7fb; --card:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb;
      --accent:#111827;
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg);
      font-family: system-ui, -apple-system, "Microsoft JhengHei", Segoe UI, Roboto, Arial, "Noto Sans TC", sans-serif;
      color:var(--text);
    }
    .wrap{
      max-width:920px; margin:0 auto; padding:42px 20px 80px;
    }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:28px;
    }
    h1{margin:0 0 12px; font-size:28px; letter-spacing:.3px}
    p{margin:10px 0; color:#374151; line-height:1.8}
    .warn{
      background:#fff7ed; border:1px solid #fed7aa; color:#9a3412;
      padding:14px 16px; border-radius:12px; margin:14px 0 22px;
    }
    .controls{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:6px}
    button{
      border:1px solid var(--border); background:#111827; color:#fff; border-radius:12px; cursor:pointer;
      padding:12px 18px; font-size:16px; letter-spacing:.5px;
    }
    button[disabled]{opacity:.5; cursor:not-allowed}
    .ghost{
      background:#fff; color:#111827;
    }
    label{font-size:14px; color:var(--muted)}
    input[type="number"]{width:90px; padding:8px 10px; border:1px solid var(--border); border-radius:10px}
    .meta{margin-top:10px; font-size:14px; color:var(--muted)}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
         background:#f3f4f6; border:1px solid #e5e7eb; border-radius:6px; padding:2px 6px}
    footer{margin-top:30px; color:var(--muted); font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>æ•´äººå½ˆçª—ç¤ºç¯„</h1>
      <p class="warn">åƒ…ä¾›æ•™å­¸ï¼å¨›æ¨‚ï¼Œè«‹åœ¨æ‰€æœ‰äººçŸ¥æƒ…èˆ‡åŒæ„çš„æƒ…å¢ƒä¸‹ä½¿ç”¨ã€‚è«‹å‹¿ç”¨æ–¼é¨·æ“¾æˆ–æ“¾äº‚å…¬å…±ç’°å¢ƒã€‚</p>

      <p>èªªæ˜ï¼šç¾ä»£ç€è¦½å™¨æœƒé˜»æ“‹è‡ªå‹•å½ˆçª—ï¼Œå¿…é ˆç¶“ç”±ä¸€æ¬¡ã€Œä½¿ç”¨è€…é»æ“Šã€æ‰å¯å¤§é‡é–‹å•Ÿè¦–çª—ã€‚ä¸‹æ–¹æŒ‰ <b>é–‹å§‹</b> ä¾¿æœƒæŒçºŒå½ˆå‡ºæ–°è¦–çª—ï¼Œç›´åˆ°æŒ‰ <b>åœæ­¢</b> æˆ–æŒ‰ä¸‹ <span class="kbd">Esc</span>ã€‚</p>

      <div class="controls">
        <button id="start">é–‹å§‹ï¼ˆé€£ç™¼ï¼‰</button>
        <button id="burst" class="ghost">åªå™´ä¸€æ³¢</button>
        <button id="stop" class="ghost" disabled>åœæ­¢ / å…¨éƒ¨é—œé–‰</button>

        <label>æ¯æ³¢æ•¸é‡
          <input id="count" type="number" min="1" max="30" value="10" />
        </label>
        <label>é–“éš”æ¯«ç§’
          <input id="interval" type="number" min="200" max="3000" step="100" value="800" />
        </label>
        <label>ä¸Šé™ç¸½æ•¸
          <input id="cap" type="number" min="10" max="200" value="60" />
        </label>
      </div>

      <div class="meta">ç›®å‰é–‹å•Ÿçš„è¦–çª—æ•¸ï¼š<span id="live">0</span></div>
      <footer>å°æ’‡æ­¥ï¼šç¬¬ä¸€æ¬¡é»æ“Šé é¢ä»»ä¸€è™•ï¼Œä¹Ÿæœƒè‡ªå‹•é–‹å§‹ï¼ˆæ–¹ä¾¿ã€Œä¸€é–‹å°±å½ˆã€çš„æ•ˆæœï¼‰ã€‚</footer>
    </div>
  </div>

  <script>
  (()=>{
    const $ = (sel)=> document.querySelector(sel);
    const startBtn = $('#start');
    const burstBtn = $('#burst');
    const stopBtn = $('#stop');
    const liveEl = $('#live');
    const countEl = $('#count');
    const ivEl = $('#interval');
    const capEl = $('#cap');

    /** è¿½è¹¤å·²é–‹å•Ÿè¦–çª— */
    let popups = [];
    let timer = null;

    /** ç§»é™¤å·²é—œé–‰çš„è¦–çª—ä¸¦æ›´æ–°çµ±è¨ˆ */
    function sweep(){
      popups = popups.filter(w => w && !w.closed);
      liveEl.textContent = popups.length;
      stopBtn.disabled = (!timer && popups.length === 0);
      startBtn.disabled = !!timer;
    }

    setInterval(sweep, 1000);

    function randomInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }

    /** é–‹å•Ÿä¸€å€‹å½ˆçª— */
    function openPopup(i){
      const w = randomInt(320, 520);
      const h = randomInt(200, 360);
      const left = randomInt(0, Math.max(0, (screen.availWidth||window.outerWidth) - w));
      const top  = randomInt(0, Math.max(0, (screen.availHeight||window.outerHeight) - h));
      const name = `_prank_${Date.now()}_${i}_${Math.random().toString(36).slice(2,7)}`;
      const win = window.open('', name, `popup=yes,width=${w},height=${h},left=${left},top=${top},menubar=no,toolbar=no,location=no,status=no,scrollbars=no,resizable=yes`);
      if(!win){
        alert('ç€è¦½å™¨é˜»æ“‹äº†å½ˆå‡ºè¦–çª—ï¼Œè«‹åœ¨ç¶²å€åˆ—å³å´å…è¨±æ­¤ç¶²ç«™çš„å½ˆå‡ºè¦–çª—å¾Œå†è©¦ã€‚');
        stopPrank();
        return null;
      }
      try{
        const bgHue = randomInt(0, 360);
        win.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>é©šå–œå½ˆçª—</title>
          <style>
            html,body{height:100%} body{margin:0; display:grid; place-items:center; font-family:system-ui,-apple-system,"Microsoft JhengHei",sans-serif}
            .box{
              text-align:center; padding:18px 20px; border-radius:16px;
              background: hsl(${bgHue} 100% 97%);
              border: 1px solid hsl(${bgHue} 60% 80%);
            }
            h2{margin:0 0 8px; font-size:20px}
            p{margin:6px 0 12px; color:#374151}
            button{padding:8px 12px; border-radius:10px; border:1px solid #d1d5db; background:#fff; cursor:pointer}
          </style>
        </head><body>
          <div class="box">
            <h2>ğŸ˜ˆ é©šå–œï¼</h2>
            <p>é€™æ˜¯ç¤ºç¯„ç”¨çš„å½ˆçª—ã€‚</p>
            <button onclick="window.close()">é—œé–‰æˆ‘</button>
            <p style="font-size:12px;color:#6b7280;margin-top:8px">æŒ‰ Esc å¯é—œé–‰æ‰€æœ‰å½ˆçª—</p>
          </div>
        </body></html>`);
        win.document.close();
      }catch(e){ /* ignore cross-origin issues */ }
      return win;
    }

    function burst(num){
      const cap = Number(capEl.value)||60;
      let opened = 0;
      for(let i=0; i<num; i++){
        if(popups.length >= cap){ stopPrank(); break; }
        const w = openPopup(i);
        if(w){ popups.push(w); opened++; }
      }
      sweep();
      return opened;
    }

    function startPrank(){
      if(timer) return;
      burst(Number(countEl.value)||10);
      timer = setInterval(()=>{
        burst(Number(countEl.value)||10);
      }, Number(ivEl.value)||800);
      sweep();
    }

    function stopPrank(){
      if(timer){ clearInterval(timer); timer = null; }
      popups.forEach(w=>{ try{ w.close(); }catch(e){} });
      popups = [];
      sweep();
    }

    startBtn.addEventListener('click', startPrank);
    burstBtn.addEventListener('click', ()=> burst(Number(countEl.value)||10));
    stopBtn.addEventListener('click', stopPrank);

    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){ stopPrank(); }
    });

    // ä¸€é–‹é é¢å°±é»ä»»ä¸€è™•ï¼Œè¦–ç‚ºé–‹å§‹ï¼ˆç¬¦åˆã€Œæ‰“é–‹å°±å½ˆã€çš„é«”æ„Ÿï¼‰
    function autoOnce(){ startPrank(); document.removeEventListener('pointerdown', autoOnce); }
    document.addEventListener('pointerdown', autoOnce, { once:true });
  })();
  </script>
</body>
</html>
